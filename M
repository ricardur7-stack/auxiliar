// Variables used by Scriptable.
// These must be at the very top of the file. Do not edit.
// always-run-in-app: true; icon-color: red;
// icon-glyph: power-off;
// === Scriptable: Painel Gamer Avançado (neon, partículas, som, animações) ===
let html = `<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>RARE CHEATS</title>
<style>
  :root{
    --bg:#070707;
    --panel:#0f0f10;
    --accent:#ff1a1a;
    --accent-2:#ff5757;
    --glass: rgba(255,255,255,0.02);
  }
  *{box-sizing:border-box}
  html,body{
    height:100%;
    margin:0;
    background:var(--bg);
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    -webkit-font-smoothing:antialiased;
    color:#fff;
    overflow:hidden;
  }

  /* PARTICLES CANVAS full background */
  #bgcanvas{
    position:fixed;
    inset:0;
    z-index:0;
    display:block;
  }

  /* Center area */
  .wrap{
    position:relative;
    z-index:5;
    width:100%;
    min-height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:30px;
  }

  /* Main panel with neon glow */
  .container{
    width:120%;
    max-width:600px;
    transform: scale(0.88);
    transform-origin: center;
    border-radius:14px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.18));
    border:2px solid var(--accent);
    box-shadow:
       0 0 30px rgba(255,26,26,0.12),
       0 8px 30px rgba(0,0,0,0.6),
       inset 0 1px 0 rgba(255,255,255,0.02);
    overflow:hidden;
    transform: translateY(-6px);
    transition: transform .22s ease, box-shadow .22s;
    position:relative;
  }

  /* Outer glow ring */
  .glow {
    pointer-events:none;
    position:absolute;
    inset:-12px;
    border-radius:18px;
    filter: blur(14px);
    background: radial-gradient(closest-side, rgba(255,26,26,0.16), transparent 60%);
    z-index:-1;
  }

  .topbar{
    display:flex;
    align-items:center;
    gap:12px;
    padding:12px 16px;
    background:linear-gradient(90deg, rgba(255,26,26,0.06), transparent);
    border-bottom:1px solid rgba(255,255,255,0.03);
  }
  .logo{
    font-weight:700;
    letter-spacing:1px;
    color:var(--accent);
    display:flex;
    align-items:center;
    gap:8px;
  }
  .logo .dot{
    width:10px;height:10px;border-radius:50%;
    background:var(--accent);
    box-shadow:0 0 8px var(--accent);
  }

  /* Tabs */
  .tabs{
    display:flex;
    gap:6px;
    margin-left:auto;
  }
  .tab {
    padding:8px 12px;
    border-radius:8px;
    background:transparent;
    color:rgba(255,255,255,0.8);
    cursor:pointer;
    font-weight:600;
    transition:transform .12s, background .12s;
    border:1px solid transparent;
  }
  .tab:hover{ transform:translateY(-3px) }
  .tab.active{
    background: linear-gradient(180deg, var(--accent), var(--accent-2));
    color:#100;
    box-shadow: 0 6px 18px rgba(255,26,26,0.22);
    border:1px solid rgba(255,255,255,0.05);
  }

  .content{
    display:flex;
    gap:22px;
    padding:18px;
  }
  /* left column (controls) */
  .col{
    flex:1 1 320px;
    min-width:240px;
  }

  .section{
    margin-bottom:14px;
    padding:12px;
    border-radius:10px;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.015));
    border:1px solid rgba(255,255,255,0.02);
    box-shadow: 0 6px 18px rgba(0,0,0,0.6);
    transition: box-shadow .2s;
  }
  .section:hover{ box-shadow: 0 14px 40px rgba(0,0,0,0.7) }

  .section h4{ margin:0 0 8px 0; font-size:14px; color:var(--accent) }
  .row{
    display:flex;
    align-items:center;
    gap:10px;
    margin:8px 0;
  }

  label.switch{
    display:flex;
    align-items:center;
    gap:10px;
    cursor:pointer;
    user-select:none;
    font-weight:600;
    color:#ddd;
  }

  /* custom checkbox look */
  .chk{
    width:46px;height:26px;border-radius:16px;
    background:rgba(255,255,255,0.08);
    position:relative;
    border:1px solid rgba(255,255,255,0.03);
    transition:background .12s, box-shadow .12s;
  }
  .chk .dot{
    position:absolute;
    top:3px; left:3px;
    width:20px;height:20px;border-radius:50%;
    background:#fff;
    transform:translateX(0);
    transition:transform .14s ease, background .12s;
    box-shadow:0 2px 6px rgba(0,0,0,0.5);
  }
  .chk.on{
    background: linear-gradient(90deg,var(--accent),var(--accent-2));
    box-shadow: 0 6px 18px rgba(255,26,26,0.14);
  }
  .chk.on .dot{ transform:translateX(20px); background:#160909 }

  /* Slider style */
  .slider-wrap{display:block}
  input[type=range]{
    -webkit-appearance:none; width:100%; height:8px; border-radius:8px;
    background: linear-gradient(90deg, var(--accent), var(--accent-2));
    outline:none; margin-top:6px;
  }
  input[type=range]::-webkit-slider-thumb{
    -webkit-appearance:none; width:18px;height:18px;border-radius:50%;
    background:#fff; box-shadow:0 4px 10px rgba(0,0,0,0.5);
    border:3px solid rgba(255,255,255,0.08);
  }

  select, .btn{
    width:100%;
    padding:10px 12px;
    border-radius:10px;
    border:1px solid rgba(255,255,255,0.04);
    background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(0,0,0,0.05));
    color:#fff;
    font-weight:600;
    cursor:pointer;
    transition:transform .12s, box-shadow .12s;
  }

  .btn{
    display:inline-block;
    text-align:center;
    box-shadow: 0 6px 18px rgba(0,0,0,0.6);
  }
  .btn:active{ transform:translateY(2px) }

  /* right column info */
  .col.small{ flex:0 0 220px; min-width:200px }
  .info-box{
    padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));
    border:1px solid rgba(255,255,255,0.03);
  }
  .picker{ display:flex; gap:8px; align-items:center; margin-top:8px }

  /* 3D buttons */
  .btn-3d{
    background:linear-gradient(180deg,#2a2a2a,#121212);
    border:1px solid rgba(255,255,255,0.04);
    box-shadow: 0 10px 30px rgba(0,0,0,0.7), 0 1px 0 rgba(255,255,255,0.02) inset;
    color:#fff; font-weight:700;
  }

  /* tiny */
  .muted{ color:rgba(255,255,255,0.6); font-size:13px }
  .val{ color:var(--accent-2); font-weight:800 }
  footer{ text-align:center; padding:10px; font-size:12px; color:rgba(255,255,255,0.45) }

  /* responsive */
  @media (max-width:640px){
    .content{ flex-direction:column; gap:12px; padding:14px }
    .col.small{ order:-1 }
  }
</style>
</head>
<body>
<canvas id="bgcanvas"></canvas>

<div class="wrap">
  <div class="container" id="panel">
    <div class="glow" id="glow"></div>

    <div class="topbar">
      <div class="logo"><div class="dot"></div>Painel</div>
      <div class="tabs">
        <div class="tab active" data-tab="0">Ajustes</div>
        <div class="tab" data-tab="1">Info</div>
      </div>
    </div>

    <div class="content">
      <div class="col">
        <div class="section">
          <h4>Opções Gerais</h4>
          <div class="row">
            <label class="switch" style="flex:1">
              <div>Ativar Auxílio</div>
              <div id="cb1" class="chk" data-state="0"><div class="dot"></div></div>
            </label>
          </div>
          <div class="row">
            <label class="switch" style="flex:1">
              <div>Ativar FOV</div>
              <div id="cb2" class="chk" data-state="0"><div class="dot"></div></div>
            </label>
          </div>
        </div>

        <div class="section">
          <h4>Ajuste de FOV</h4>
          <div class="slider-wrap">
            <input type="range" id="fov" min="10" max="200" value="80">
            <div style="display:flex;justify-content:space-between;margin-top:8px">
              <div class="muted">FOV</div>
              <div class="val" id="fovVal">80</div>
            </div>
          </div>
        </div>

        <div class="section">
          <h4>Região</h4>
          <select id="region">
            <option value="head">Cabeça</option>
            <option value="neck">Pescoço</option>
            <option value="chest">Peito</option>
            <option value="recoil">Recoil</option>
          </select>
        </div>

        <div class="section">
          <h4>Tipo</h4>
          <select id="mode">
            <option value="look">Ao olhar</option>
            <option value="shoot">Ao atirar</option>
          </select>
        </div>

        <div style="display:flex;gap:8px;margin-top:8px">
          <div class="btn btn-3d" id="apply" style="flex:1;padding:12px">Aplicar</div>
          <div class="btn btn-3d" id="reset" style="flex:1;padding:12px">Reset</div>
        </div>
      </div>

      <div class="col small">
        <div class="info-box section">
          <h4>Personalização</h4>
          <div class="picker">
            <div style="flex:1">
              <div class="muted">Cor principal</div>
              <input type="color" id="colorPicker" value="#ff1a1a" style="width:100%;height:40px;border-radius:8px;border:0;margin-top:6px">
            </div>
          </div>

          <div style="margin-top:12px">
            <div class="muted">Brilho do painel</div>
            <input type="range" id="glowRange" min="0" max="40" value="14">
          </div>

          <div style="margin-top:12px">
            <div class="muted">Efeitos sonoros</div>
            <div style="display:flex;gap:8px;margin-top:8px">
              <div class="btn" id="playSound" style="padding:8px">Testar Som</div>
              <div class="btn" id="mute" style="padding:8px">Ativar</div>
            </div>
          </div>
        </div>

        <div class="section" style="margin-top:12px">
          <h4>Status</h4>
          <div class="muted">FOV atual: <span id="statusFov">80</span></div>
          <div class="muted" style="margin-top:6px">Região: <span id="statusRegion">Cabeça</span></div>
          <div class="muted" style="margin-top:6px">Tipo: <span id="statusMode">Ao olhar</span></div>
        </div>
      </div>
    </div>

    <footer>Versão UI • Estilo Neon • Scriptable</footer>

  </div>
</div>

<script>
/* ---------- PARTICLES BACKGROUND ---------- */
const canvas = document.getElementById('bgcanvas');
const ctx = canvas.getContext('2d');
let W = canvas.width = window.innerWidth;
let H = canvas.height = window.innerHeight;

window.addEventListener('resize', () => {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
});

let particles = [];
const PCOUNT = Math.max(40, Math.round((W*H)/80000));
for(let i=0;i<PCOUNT;i++){
  particles.push({
    x: Math.random()*W,
    y: Math.random()*H,
    r: 0.6 + Math.random()*2.5,
    vx: (Math.random()-0.5)*0.25,
    vy: (Math.random()-0.5)*0.25,
    hue: 0.02 + Math.random()*0.08
  });
}

function draw(){
  ctx.clearRect(0,0,W,H);
  // subtle background gradient
  let g = ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0, 'rgba(8,8,12,0.85)');
  g.addColorStop(1, 'rgba(6,6,8,0.95)');
  ctx.fillStyle = g;
  ctx.fillRect(0,0,W,H);

  // draw lines between close particles
  for(let p of particles){
    ctx.beginPath();
    ctx.fillStyle = 'rgba(255,255,255,0.03)';
    ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
    ctx.fill();
  }
  for(let i=0;i<particles.length;i++){
    for(let j=i+1;j<particles.length;j++){
      let a = particles[i], b = particles[j];
      let dx = a.x-b.x, dy = a.y-b.y;
      let d = Math.sqrt(dx*dx+dy*dy);
      if(d<120){
        ctx.beginPath();
        ctx.strokeStyle = 'rgba(255,26,26,' + (0.12*(1-d/120)) + ')';
        ctx.lineWidth = 1*(1-d/120);
        ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke();
      }
    }
  }
}

function update(){
  for(let p of particles){
    p.x += p.vx;
    p.y += p.vy;
    // subtle sinusoidal movement
    p.x += Math.sin((p.y + Date.now()/2000) * p.hue) * 0.2;
    p.y += Math.cos((p.x + Date.now()/2000) * p.hue) * 0.2;

    if(p.x < -20) p.x = W+20;
    if(p.x > W+20) p.x = -20;
    if(p.y < -20) p.y = H+20;
    if(p.y > H+20) p.y = -20;
  }
}

function loop(){
  update(); draw();
  requestAnimationFrame(loop);
}
loop();

/* ---------- UI INTERACTIONS ---------- */
const tabs = document.querySelectorAll('.tab');
tabs.forEach(t => t.addEventListener('click', () => {
  tabs.forEach(x=>x.classList.remove('active'));
  t.classList.add('active');
  const idx = t.getAttribute('data-tab');
  document.querySelectorAll('.content')[0].style.display = (idx==0? 'flex' : 'none');
  // show info column always for responsiveness
  if(idx==1){
    // mimic tab switching by hiding left column on small screens
    // handled by CSS responsive; keep simple
  } else {
    document.querySelectorAll('.content')[0].style.display = 'flex';
  }
}));

// custom checkbox toggles
function toggleChk(el){
  const on = el.classList.toggle('on');
  el.setAttribute('data-state', on?1:0);
  playClick();
}
document.getElementById('cb1').addEventListener('click', e=> toggleChk(e.currentTarget));
document.getElementById('cb2').addEventListener('click', e=> toggleChk(e.currentTarget));

// slider update
const fov = document.getElementById('fov');
const fovVal = document.getElementById('fovVal');
const statusFov = document.getElementById('statusFov');
fov.addEventListener('input', ()=> {
  fovVal.textContent = fov.value;
  statusFov.textContent = fov.value;
});

// selects update
const reg = document.getElementById('region');
const mode = document.getElementById('mode');
const statusRegion = document.getElementById('statusRegion');
const statusMode = document.getElementById('statusMode');
reg.addEventListener('change', ()=> statusRegion.textContent = reg.options[reg.selectedIndex].text);
mode.addEventListener('change', ()=> statusMode.textContent = mode.options[mode.selectedIndex].text);

// color picker changes theme accents and glow
const colorPicker = document.getElementById('colorPicker');
const glowRange = document.getElementById('glowRange');
const panel = document.getElementById('panel');
const glowEl = document.getElementById('glow');

function applyAccent(hex){
  // set CSS variables dynamically
  document.documentElement.style.setProperty('--accent', hex);
  // set secondary slightly lighter
  function light(hexcol,amt){
    let c = hexcol.replace('#','');
    let num = parseInt(c,16);
    let r = Math.min(255,((num>>16)&255) + amt);
    let g = Math.min(255,((num>>8)&255) + amt);
    let b = Math.min(255,(num&255) + amt);
    return '#'+((1<<24) + (r<<16) + (g<<8) + b).toString(16).slice(1);
  }
  document.documentElement.style.setProperty('--accent-2', light(hex,70));
  glowEl.style.background = 'radial-gradient(closest-side, '+hex+'55, transparent 60%)';
}
applyAccent(colorPicker.value);

colorPicker.addEventListener('input', (e)=> applyAccent(e.target.value));
glowRange.addEventListener('input', (e)=> {
  let v = e.target.value;
  glowEl.style.filter = 'blur('+v+'px)';
  glowEl.style.opacity = Math.min(1, 0.02 + v/50);
});

/* ---------- Neon hover effect on panel ---------- */
panel.addEventListener('mouseenter', ()=> {
  panel.style.transform = 'translateY(0)';
  panel.style.boxShadow = '0 20px 60px rgba(0,0,0,0.6), 0 0 60px var(--accent)';
});
panel.addEventListener('mouseleave', ()=> {
  panel.style.transform = 'translateY(-6px)';
  panel.style.boxShadow = '0 0 30px rgba(255,26,26,0.12), 0 8px 30px rgba(0,0,0,0.6)';
});

/* ---------- 3D buttons and sound ---------- */
let audioEnabled = true;
const playBtn = document.getElementById('playSound');
const muteBtn = document.getElementById('mute');

playBtn.addEventListener('click', ()=> playTone(880, 0.12));
muteBtn.addEventListener('click', ()=> {
  audioEnabled = !audioEnabled;
  muteBtn.textContent = audioEnabled? 'Ativar' : 'Mutado';
  playClick();
});

function playClick(){
  if(!audioEnabled) return;
  playTone(1200, 0.04);
}
document.getElementById('apply').addEventListener('click', ()=> {
  playClick();
  flash('#0f0f0f');
});
document.getElementById('reset').addEventListener('click', ()=> {
  playClick();
  // reset values
  fov.value = 80; fov.dispatchEvent(new Event('input'));
  reg.selectedIndex = 0; reg.dispatchEvent(new Event('change'));
  mode.selectedIndex = 0; mode.dispatchEvent(new Event('change'));
  colorPicker.value = '#ff1a1a'; applyAccent('#ff1a1a');
  glowRange.value = 14; glowRange.dispatchEvent(new Event('input'));
});

/* WebAudio tone generator (works in WKWebView) */
let AudioCtx = window.AudioContext || window.webkitAudioContext;
let actx = null;
function ensureCtx(){
  if(!actx) actx = new AudioCtx();
}
function playTone(freq=440, dur=0.1){
  if(!audioEnabled) return;
  try{
    ensureCtx();
    let o = actx.createOscillator();
    let g = actx.createGain();
    o.type = 'sine';
    o.frequency.value = freq;
    g.gain.value = 0.02;
    o.connect(g); g.connect(actx.destination);
    o.start();
    g.gain.exponentialRampToValueAtTime(0.0001, actx.currentTime + dur);
    o.stop(actx.currentTime + dur + 0.02);
  }catch(e){
    // Some WKWebView contexts refrain from autoplay until user action; ignore
    console.log('Audio err', e);
  }
}

/* small flash effect on apply */
function flash(col){
  let o = document.createElement('div');
  o.style.position='fixed'; o.style.inset=0; o.style.zIndex=9999;
  o.style.background=col; o.style.opacity=0.06; o.style.pointerEvents='none';
  document.body.appendChild(o);
  setTimeout(()=> o.style.opacity=0, 60);
  setTimeout(()=> o.remove(), 400);
}

/* init tiny state */
fov.dispatchEvent(new Event('input'));
reg.dispatchEvent(new Event('change'));
mode.dispatchEvent(new Event('change'));

</script>
</body>
</html>
`;

// Load in Scriptable WebView
let web = new WebView();
await web.loadHTML(html);
await web.present();
